{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import toast from'react-hot-toast';import ACTIONS from'../Actions';import Client from'../components/Client';import Editor1 from'../components/Editor1';import Editor from'../components/Editor';import{initSocket}from'../socket';import{useLocation,useNavigate,Navigate,useParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const EditorPage=()=>{const socketRef=useRef(null);const codeRef=useRef(null);const location=useLocation();const{roomId}=useParams();const reactNavigator=useNavigate();const[clients,setClients]=useState([]);useEffect(()=>{const init=async()=>{var _location$state;socketRef.current=await initSocket();socketRef.current.on('connect_error',err=>handleErrors(err));socketRef.current.on('connect_failed',err=>handleErrors(err));function handleErrors(e){console.log('socket error',e);toast.error('Socket connection failed, try again later.');reactNavigator('/');}socketRef.current.emit(ACTIONS.JOIN,{roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username});// Listening for joined event\nsocketRef.current.on(ACTIONS.JOINED,_ref=>{var _location$state2;let{clients,username,socketId}=_ref;if(username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(\"\".concat(username,\" joined the room.\"));console.log(\"\".concat(username,\" joined\"));}setClients(clients);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId});});// Listening for disconnected\nsocketRef.current.on(ACTIONS.DISCONNECTED,_ref2=>{let{socketId,username}=_ref2;toast.success(\"\".concat(username,\" left the room.\"));setClients(prev=>{return prev.filter(client=>client.socketId!==socketId);});});};init();return()=>{socketRef.current.disconnect();socketRef.current.off(ACTIONS.JOINED);socketRef.current.off(ACTIONS.DISCONNECTED);};},[]);async function copyRoomId(){try{await navigator.clipboard.writeText(roomId);toast.success('Room ID has been copied to your clipboard');}catch(err){toast.error('Could not copy the Room ID');console.error(err);}}function leaveRoom(){reactNavigator('/');}if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",src:\"/Code_Unity.png\",alt:\"logo\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientsList\",children:clients.map(client=>/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId))})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editorWrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:code=>{codeRef.current=code;}})})]});};export default EditorPage;","map":{"version":3,"names":["React","useState","useRef","useEffect","toast","ACTIONS","Client","Editor1","Editor","initSocket","useLocation","useNavigate","Navigate","useParams","jsx","_jsx","jsxs","_jsxs","EditorPage","socketRef","codeRef","location","roomId","reactNavigator","clients","setClients","init","_location$state","current","on","err","handleErrors","e","console","log","error","emit","JOIN","username","state","JOINED","_ref","_location$state2","socketId","success","concat","SYNC_CODE","code","DISCONNECTED","_ref2","prev","filter","client","disconnect","off","copyRoomId","navigator","clipboard","writeText","leaveRoom","to","className","children","src","alt","map","onClick","onCodeChange"],"sources":["D:/HTML-CSS_Course/React/realtime-editor/src/pages/EditorPage.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport toast from 'react-hot-toast';\r\nimport ACTIONS from '../Actions';\r\nimport Client from '../components/Client';\r\nimport Editor1 from '../components/Editor1';\r\nimport Editor from '../components/Editor';\r\nimport { initSocket } from '../socket';\r\nimport {\r\n    useLocation,\r\n    useNavigate,\r\n    Navigate,\r\n    useParams,\r\n} from 'react-router-dom';\r\n\r\nconst EditorPage = () => {\r\n    const socketRef = useRef(null);\r\n    const codeRef = useRef(null);\r\n    const location = useLocation();\r\n    const { roomId } = useParams();\r\n    const reactNavigator = useNavigate();\r\n    const [clients, setClients] = useState([]);\r\n\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            socketRef.current = await initSocket();\r\n            socketRef.current.on('connect_error', (err) => handleErrors(err));\r\n            socketRef.current.on('connect_failed', (err) => handleErrors(err));\r\n\r\n            function handleErrors(e) {\r\n                console.log('socket error', e);\r\n                toast.error('Socket connection failed, try again later.');\r\n                reactNavigator('/');\r\n            }\r\n\r\n            socketRef.current.emit(ACTIONS.JOIN, {\r\n                roomId,\r\n                username: location.state?.username,\r\n            });\r\n\r\n            // Listening for joined event\r\n            socketRef.current.on(\r\n                ACTIONS.JOINED,\r\n                ({ clients, username, socketId }) => {\r\n                    if (username !== location.state?.username) {\r\n                        toast.success(`${username} joined the room.`);\r\n                        console.log(`${username} joined`);\r\n                    }\r\n                    setClients(clients);\r\n                    socketRef.current.emit(ACTIONS.SYNC_CODE, {\r\n                        code: codeRef.current,\r\n                        socketId,\r\n                    });\r\n                }\r\n            );\r\n\r\n            // Listening for disconnected\r\n            socketRef.current.on(\r\n                ACTIONS.DISCONNECTED,\r\n                ({ socketId, username }) => {\r\n                    toast.success(`${username} left the room.`);\r\n                    setClients((prev) => {\r\n                        return prev.filter(\r\n                            (client) => client.socketId !== socketId\r\n                        );\r\n                    });\r\n                }\r\n            );\r\n        };\r\n        init();\r\n        return () => {\r\n            socketRef.current.disconnect();\r\n            socketRef.current.off(ACTIONS.JOINED);\r\n            socketRef.current.off(ACTIONS.DISCONNECTED);\r\n        };\r\n    }, []);\r\n\r\n    async function copyRoomId() {\r\n        try {\r\n            await navigator.clipboard.writeText(roomId);\r\n            toast.success('Room ID has been copied to your clipboard');\r\n        } catch (err) {\r\n            toast.error('Could not copy the Room ID');\r\n            console.error(err);\r\n        }\r\n    }\r\n\r\n    function leaveRoom() {\r\n        reactNavigator('/');\r\n    }\r\n\r\n    if (!location.state) {\r\n        return <Navigate to=\"/\" />;\r\n    }\r\n\r\n    return (\r\n        <div className=\"mainWrap\">\r\n            <div className=\"aside\">\r\n                <div className=\"asideInner\">\r\n                    <div className=\"logo\">\r\n                        <img\r\n                            className=\"logoImage\"\r\n                            src=\"/Code_Unity.png\"\r\n                            alt=\"logo\"\r\n                        />\r\n                    </div>\r\n                    <h3>Connected</h3>\r\n                    <div className=\"clientsList\">\r\n                        {clients.map((client) => (\r\n                            <Client\r\n                                key={client.socketId}\r\n                                username={client.username}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n                    {/* <Editor1/> */}\r\n                </div>\r\n                <button className=\"btn copyBtn\" onClick={copyRoomId}>\r\n                    Copy ROOM ID\r\n                </button>\r\n                <button className=\"btn leaveBtn\" onClick={leaveRoom}>\r\n                    Leave\r\n                </button>\r\n            </div>\r\n            <div className=\"editorWrap\">\r\n                <Editor\r\n                    socketRef={socketRef}\r\n                    roomId={roomId}\r\n                    onCodeChange={(code) => {\r\n                        codeRef.current = code;\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default EditorPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}